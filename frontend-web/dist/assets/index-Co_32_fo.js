import{c as D,r as i,j as e,D as H,S,d as f,F as u,g as O,h as K,M as b,i as F,B as L,C as R,u as Z,I,e as E,T as V}from"./index-Cg5IDLAj.js";import{H as $}from"./index.esm-DfLd64sW.js";import{P as J}from"./index-tmcc6wld.js";import{C as G}from"./Card-BV0-onuQ.js";import{C as B}from"./CardHeader-c11d5-bw.js";import{C as U}from"./CardContent-BQ3L2MZB.js";import{A as p}from"./Alert-BfQRkqTI.js";import{R as _}from"./RadioGroup-DA1CbyGY.js";import{F as g}from"./FormControlLabel-Bs_lCMXG.js";import{R as j}from"./Radio-D51LFH-X.js";import{V as W,a as k}from"./VisibilityOff-CS5vLWo5.js";import{C as Q}from"./Container-CmgLE638.js";import{G as z}from"./Grid-DHwwlgrX.js";import"./SwitchBase-DYWrE_Tu.js";function X(){const{user:a,updateProfile:y,isLoading:r,error:m,clearError:h}=D(),[s,w]=i.useState({name:a?.name||"",username:a?.username||"",timezone:a?.timezone||"Asia/Ho_Chi_Minh",language:a?.language||"VI",theme:a?.theme||"SYSTEM"}),[l,P]=i.useState({name:"",username:""}),[d,C]=i.useState("");i.useEffect(()=>{a&&w({name:a.name||"",username:a.username||"",timezone:a.timezone||"Asia/Ho_Chi_Minh",language:a.language||"VI",theme:a.theme||"SYSTEM"})},[a]);const x=()=>{const n={name:"",username:""};return s.name&&s.name.length>100&&(n.name="Name must be 100 characters or less"),s.username&&(s.username.length<3||s.username.length>30?n.username="Username must be 3-30 characters":/^[a-zA-Z0-9_-]+$/.test(s.username)||(n.username="Username must be alphanumeric + underscore/hyphen only")),P(n),!n.name&&!n.username},N=async()=>{if(h(),C(""),!!x())try{await y(s),C("Profile updated successfully!")}catch(n){console.error("Profile update failed:",n)}},t=n=>v=>{w(c=>({...c,[n]:v.target.value})),P(c=>({...c,[n]:""}))};return e.jsxs(G,{children:[e.jsx(B,{title:"Profile Settings"}),e.jsx(H,{}),e.jsx(U,{children:e.jsxs(S,{spacing:3,children:[m&&e.jsx(p,{severity:"error",onClose:h,children:m}),d&&e.jsx(p,{severity:"success",children:d}),e.jsx(f,{label:"Name",value:s.name,onChange:t("name"),fullWidth:!0,error:!!l.name,helperText:l.name,disabled:r}),e.jsx(f,{label:"Username",value:s.username,onChange:t("username"),fullWidth:!0,error:!!l.username,helperText:l.username||"3-30 characters, alphanumeric + underscore/hyphen",disabled:r}),e.jsxs(u,{fullWidth:!0,children:[e.jsx(O,{children:"Timezone"}),e.jsxs(K,{value:s.timezone,label:"Timezone",onChange:t("timezone"),disabled:r,children:[e.jsx(b,{value:"Asia/Ho_Chi_Minh",children:"Asia/Ho_Chi_Minh (GMT+7)"}),e.jsx(b,{value:"Asia/Bangkok",children:"Asia/Bangkok (GMT+7)"}),e.jsx(b,{value:"Asia/Singapore",children:"Asia/Singapore (GMT+8)"}),e.jsx(b,{value:"UTC",children:"UTC"})]})]}),e.jsxs(u,{component:"fieldset",children:[e.jsx(F,{component:"legend",children:"Language"}),e.jsxs(_,{row:!0,value:s.language,onChange:t("language"),children:[e.jsx(g,{value:"VI",control:e.jsx(j,{}),label:"Vietnamese",disabled:r}),e.jsx(g,{value:"EN",control:e.jsx(j,{}),label:"English",disabled:r})]})]}),e.jsxs(u,{component:"fieldset",children:[e.jsx(F,{component:"legend",children:"Theme"}),e.jsxs(_,{row:!0,value:s.theme,onChange:t("theme"),children:[e.jsx(g,{value:"LIGHT",control:e.jsx(j,{}),label:"Light",disabled:r}),e.jsx(g,{value:"DARK",control:e.jsx(j,{}),label:"Dark",disabled:r}),e.jsx(g,{value:"SYSTEM",control:e.jsx(j,{}),label:"System",disabled:r})]})]}),e.jsx(S,{direction:"row",spacing:2,children:e.jsx(L,{variant:"contained",onClick:N,disabled:r,startIcon:r&&e.jsx(R,{size:20}),children:r?"Saving...":"Save Changes"})})]})})]})}function ee(){const a=Z(),{changePassword:y,isLoading:r,error:m,clearError:h}=D(),[s,w]=i.useState({currentPassword:"",newPassword:"",confirmNewPassword:""}),[l,P]=i.useState(!1),[d,C]=i.useState(!1),[x,N]=i.useState(!1),[t,n]=i.useState({currentPassword:"",newPassword:"",confirmNewPassword:""}),[v,c]=i.useState(""),Y=()=>{const o={currentPassword:"",newPassword:"",confirmNewPassword:""};return s.currentPassword||(o.currentPassword="Current password is required"),s.newPassword?s.newPassword.length<8&&(o.newPassword="New password must be at least 8 characters"):o.newPassword="New password is required",s.confirmNewPassword?s.newPassword!==s.confirmNewPassword&&(o.confirmNewPassword="Passwords do not match"):o.confirmNewPassword="Please confirm your new password",n(o),Object.values(o).every(M=>!M)},q=async()=>{if(h(),c(""),!!Y())try{await y(s),c("Password changed successfully! Redirecting to login..."),w({currentPassword:"",newPassword:"",confirmNewPassword:""}),setTimeout(()=>{a("/login")},2e3)}catch(o){console.error("Password change failed:",o)}},T=o=>M=>{w(A=>({...A,[o]:M.target.value})),n(A=>({...A,[o]:""}))};return e.jsxs(G,{children:[e.jsx(B,{title:"Change Password"}),e.jsx(H,{}),e.jsx(U,{children:e.jsxs(S,{spacing:3,children:[e.jsx(p,{severity:"info",children:"You will be logged out from all devices after changing your password."}),m&&e.jsx(p,{severity:"error",onClose:h,children:m}),v&&e.jsx(p,{severity:"success",children:v}),e.jsx(u,{fullWidth:!0,children:e.jsx(f,{label:"Current Password",type:l?"text":"password",value:s.currentPassword,onChange:T("currentPassword"),fullWidth:!0,error:!!t.currentPassword,helperText:t.currentPassword,disabled:r,InputProps:{endAdornment:e.jsx(I,{position:"end",children:e.jsx(E,{onClick:()=>P(!l),edge:"end",children:l?e.jsx(W,{}):e.jsx(k,{})})})}})}),e.jsx(u,{fullWidth:!0,children:e.jsx(f,{label:"New Password",type:d?"text":"password",value:s.newPassword,onChange:T("newPassword"),fullWidth:!0,error:!!t.newPassword,helperText:t.newPassword||"Minimum 8 characters",disabled:r,InputProps:{endAdornment:e.jsx(I,{position:"end",children:e.jsx(E,{onClick:()=>C(!d),edge:"end",children:d?e.jsx(W,{}):e.jsx(k,{})})})}})}),e.jsx(u,{fullWidth:!0,children:e.jsx(f,{label:"Confirm New Password",type:x?"text":"password",value:s.confirmNewPassword,onChange:T("confirmNewPassword"),fullWidth:!0,error:!!t.confirmNewPassword,helperText:t.confirmNewPassword,disabled:r,InputProps:{endAdornment:e.jsx(I,{position:"end",children:e.jsx(E,{onClick:()=>N(!x),edge:"end",children:x?e.jsx(W,{}):e.jsx(k,{})})})}})}),e.jsx(S,{direction:"row",spacing:2,children:e.jsx(L,{variant:"contained",color:"primary",onClick:q,disabled:r,startIcon:r&&e.jsx(R,{size:20}),children:r?"Changing Password...":"Change Password"})})]})})]})}function xe(){return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx("title",{children:"Settings - RepeatWise"})}),e.jsxs(J,{children:[e.jsx(V,{variant:"h3",component:"h3",gutterBottom:!0,children:"Settings"}),e.jsx(V,{variant:"subtitle2",children:"Manage your profile and account settings"})]}),e.jsx(Q,{maxWidth:"lg",children:e.jsxs(z,{container:!0,direction:"row",justifyContent:"center",alignItems:"stretch",spacing:3,children:[e.jsx(z,{item:!0,xs:12,children:e.jsx(X,{})}),e.jsx(z,{item:!0,xs:12,children:e.jsx(ee,{})})]})})]})}export{xe as default};
