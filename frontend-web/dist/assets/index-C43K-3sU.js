import{ah as we,ai as Se,aj as k,ak as ie,al as V,am as ae,an as he,ao as Fe,ap as ze,aq as se,ar as Ne,as as Le,at as Re,au as le,av as Me,aw as Ae,r as l,ax as Oe,ay as H,m as Qe,l as _e,p as Ue,_ as $e,o as ue,j as t,s as He,q as We,v as Be,k as P,az as z,a as j,C as _,T as b,e as pe,a7 as Ke,M as K,P as T,aA as J,aB as X,aC as Z,d as G,B as E,aD as O,N as xe,O as W,a1 as oe}from"./index-Cg5IDLAj.js";import{H as qe}from"./index.esm-DfLd64sW.js";import{P as Ve}from"./index-B7uxLcAL.js";import{P as Ge}from"./index-tmcc6wld.js";import{C as re}from"./Card-BV0-onuQ.js";import{C as ne}from"./CardContent-BQ3L2MZB.js";import{A as U}from"./Alert-BfQRkqTI.js";import{L as q}from"./ListItemIcon-XAj5r27b.js";import{C as Ye}from"./Collapse-bpGIEQtI.js";import{C as Je}from"./Container-CmgLE638.js";import{G as de}from"./Grid-DHwwlgrX.js";import"./AddTwoTone-BjFP_H9d.js";var Xe=class extends we{constructor(e,s){super(),this.options=s,this.#s=e,this.#o=null,this.#a=Se(),this.bindMethods(),this.setOptions(s)}#s;#e=void 0;#r=void 0;#t=void 0;#n;#i;#a;#o;#x;#u;#p;#c;#d;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),De(this.#e,this.options)?this.#h():this.updateResult(),this.#j())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return me(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return me(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#b(),this.#e.removeObserver(this)}setOptions(e){const s=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof k(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#e.setOptions(this.options),s._defaulted&&!ie(this.options,s)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const n=this.hasListeners();n&&Ie(this.#e,r,this.options,s)&&this.#h(),this.updateResult(),n&&(this.#e!==r||k(this.options.enabled,this.#e)!==k(s.enabled,this.#e)||V(this.options.staleTime,this.#e)!==V(s.staleTime,this.#e))&&this.#f();const i=this.#g();n&&(this.#e!==r||k(this.options.enabled,this.#e)!==k(s.enabled,this.#e)||i!==this.#l)&&this.#y(i)}getOptimisticResult(e){const s=this.#s.getQueryCache().build(this.#s,e),r=this.createResult(s,e);return et(this,r)&&(this.#t=r,this.#i=this.options,this.#n=this.#e.state),r}getCurrentResult(){return this.#t}trackResult(e,s){return new Proxy(e,{get:(r,n)=>(this.trackProp(n),s?.(n),n==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,n))})}trackProp(e){this.#m.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=this.#s.defaultQueryOptions(e),r=this.#s.getQueryCache().build(this.#s,s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#h(e){this.#C();let s=this.#e.fetch(this.options,e);return e?.throwOnError||(s=s.catch(ae)),s}#f(){this.#v();const e=V(this.options.staleTime,this.#e);if(he||this.#t.isStale||!Fe(e))return;const r=ze(this.#t.dataUpdatedAt,e)+1;this.#c=se.setTimeout(()=>{this.#t.isStale||this.updateResult()},r)}#g(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#y(e){this.#b(),this.#l=e,!(he||k(this.options.enabled,this.#e)===!1||!Fe(this.#l)||this.#l===0)&&(this.#d=se.setInterval(()=>{(this.options.refetchIntervalInBackground||Ne.isFocused())&&this.#h()},this.#l))}#j(){this.#f(),this.#y(this.#g())}#v(){this.#c&&(se.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#d&&(se.clearInterval(this.#d),this.#d=void 0)}createResult(e,s){const r=this.#e,n=this.options,i=this.#t,o=this.#n,a=this.#i,c=e!==r?e.state:this.#r,{state:h}=e;let u={...h},x=!1,d;if(s._optimisticResults){const F=this.hasListeners(),L=!F&&De(e,s),A=F&&Ie(e,r,s,n);(L||A)&&(u={...u,...Le(h.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:f,errorUpdatedAt:C,status:R}=u;d=u.data;let M=!1;if(s.placeholderData!==void 0&&d===void 0&&R==="pending"){let F;i?.isPlaceholderData&&s.placeholderData===a?.placeholderData?(F=i.data,M=!0):F=typeof s.placeholderData=="function"?s.placeholderData(this.#p?.state.data,this.#p):s.placeholderData,F!==void 0&&(R="success",d=Re(i?.data,F,s),x=!0)}if(s.select&&d!==void 0&&!M)if(i&&d===o?.data&&s.select===this.#x)d=this.#u;else try{this.#x=s.select,d=s.select(d),d=Re(i?.data,d,s),this.#u=d,this.#o=null}catch(F){this.#o=F}this.#o&&(f=this.#o,d=this.#u,C=Date.now(),R="error");const m=u.fetchStatus==="fetching",S=R==="pending",g=R==="error",y=S&&m,D=d!==void 0,I={status:R,fetchStatus:u.fetchStatus,isPending:S,isSuccess:R==="success",isError:g,isInitialLoading:y,isLoading:y,data:d,dataUpdatedAt:u.dataUpdatedAt,error:f,errorUpdatedAt:C,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:m,isRefetching:m&&!S,isLoadingError:g&&!D,isPaused:u.fetchStatus==="paused",isPlaceholderData:x,isRefetchError:g&&D,isStale:fe(e,s),refetch:this.refetch,promise:this.#a,isEnabled:k(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const F=Q=>{I.status==="error"?Q.reject(I.error):I.data!==void 0&&Q.resolve(I.data)},L=()=>{const Q=this.#a=I.promise=Se();F(Q)},A=this.#a;switch(A.status){case"pending":e.queryHash===r.queryHash&&F(A);break;case"fulfilled":(I.status==="error"||I.data!==A.value)&&L();break;case"rejected":(I.status!=="error"||I.error!==A.reason)&&L();break}}return I}updateResult(){const e=this.#t,s=this.createResult(this.#e,this.options);if(this.#n=this.#e.state,this.#i=this.options,this.#n.data!==void 0&&(this.#p=this.#e),ie(s,e))return;this.#t=s;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:n}=this.options,i=typeof n=="function"?n():n;if(i==="all"||!i&&!this.#m.size)return!0;const o=new Set(i??this.#m);return this.options.throwOnError&&o.add("error"),Object.keys(this.#t).some(a=>{const p=a;return this.#t[p]!==e[p]&&o.has(p)})};this.#S({listeners:r()})}#C(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const s=this.#e;this.#e=e,this.#r=e.state,this.hasListeners()&&(s?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#j()}#S(e){le.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function Ze(e,s){return k(s.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&s.retryOnMount===!1)}function De(e,s){return Ze(e,s)||e.state.data!==void 0&&me(e,s,s.refetchOnMount)}function me(e,s,r){if(k(s.enabled,e)!==!1&&V(s.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&fe(e,s)}return!1}function Ie(e,s,r,n){return(e!==s||k(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&fe(e,r)}function fe(e,s){return k(s.enabled,e)!==!1&&e.isStaleByTime(V(s.staleTime,e))}function et(e,s){return!ie(e.getCurrentResult(),s)}var tt=class extends we{#s;#e=void 0;#r;#t;constructor(e,s){super(),this.#s=e,this.setOptions(s),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#s.defaultMutationOptions(e),ie(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),s?.mutationKey&&this.options.mutationKey&&Me(s.mutationKey)!==Me(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#i(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#i()}mutate(e,s){return this.#t=s,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(e)}#n(){const e=this.#r?.state??Ae();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#i(e){le.batch(()=>{if(this.#t&&this.hasListeners()){const s=this.#e.variables,r=this.#e.context,n={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#t.onSuccess?.(e.data,s,r,n),this.#t.onSettled?.(e.data,null,s,r,n)):e?.type==="error"&&(this.#t.onError?.(e.error,s,r,n),this.#t.onSettled?.(void 0,e.error,s,r,n))}this.listeners.forEach(s=>{s(this.#e)})})}},Pe=l.createContext(!1),st=()=>l.useContext(Pe);Pe.Provider;function rt(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var nt=l.createContext(rt()),it=()=>l.useContext(nt),at=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},ot=e=>{l.useEffect(()=>{e.clearReset()},[e])},lt=({result:e,errorResetBoundary:s,throwOnError:r,query:n,suspense:i})=>e.isError&&!s.isReset()&&!e.isFetching&&n&&(i&&e.data===void 0||Oe(r,[e.error,n])),ct=e=>{if(e.suspense){const r=i=>i==="static"?i:Math.max(i??1e3,1e3),n=e.staleTime;e.staleTime=typeof n=="function"?(...i)=>r(n(...i)):r(n),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},dt=(e,s)=>e.isLoading&&e.isFetching&&!s,ht=(e,s)=>e?.suspense&&s.isPending,Ee=(e,s,r)=>s.fetchOptimistic(e).catch(()=>{r.clearReset()});function ut(e,s,r){const n=st(),i=it(),o=H(),a=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(a),a._optimisticResults=n?"isRestoring":"optimistic",ct(a),at(a,i),ot(i);const p=!o.getQueryCache().get(a.queryHash),[c]=l.useState(()=>new s(o,a)),h=c.getOptimisticResult(a),u=!n&&e.subscribed!==!1;if(l.useSyncExternalStore(l.useCallback(x=>{const d=u?c.subscribe(le.batchCalls(x)):ae;return c.updateResult(),d},[c,u]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),l.useEffect(()=>{c.setOptions(a)},[a,c]),ht(a,h))throw Ee(a,c,i);if(lt({result:h,errorResetBoundary:i,throwOnError:a.throwOnError,query:o.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw h.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(a,h),a.experimental_prefetchInRender&&!he&&dt(h,n)&&(p?Ee(a,c,i):o.getQueryCache().get(a.queryHash)?.promise)?.catch(ae).finally(()=>{c.updateResult()}),a.notifyOnChangeProps?h:c.trackResult(h)}function pt(e,s){return ut(e,Xe)}function ee(e,s){const r=H(),[n]=l.useState(()=>new tt(r,e));l.useEffect(()=>{n.setOptions(e)},[n,e]);const i=l.useSyncExternalStore(l.useCallback(a=>n.subscribe(le.batchCalls(a)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),o=l.useCallback((a,p)=>{n.mutate(a,p).catch(ae)},[n]);if(i.error&&Oe(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}function mt(e){return Qe("MuiDialogActions",e)}_e("MuiDialogActions",["root","spacing"]);const xt=["className","disableSpacing"],ft=e=>{const{classes:s,disableSpacing:r}=e;return Be({root:["root",!r&&"spacing"]},mt,s)},gt=He("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:r}=e;return[s.root,!r.disableSpacing&&s.spacing]}})(({ownerState:e})=>ue({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!e.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),te=l.forwardRef(function(s,r){const n=Ue({props:s,name:"MuiDialogActions"}),{className:i,disableSpacing:o=!1}=n,a=$e(n,xt),p=ue({},n,{disableSpacing:o}),c=ft(p);return t.jsx(gt,ue({className:We(c.root,i),ownerState:p,ref:r},a))}),ge=P(t.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),yt=P(t.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight"),jt=P(t.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),vt=P(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),bt=P(t.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-6 12v-3h-4v-4h4V8l5 5z"}),"DriveFileMove"),Ct=P(t.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),St=P(t.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),Y=P(t.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),Ft=P(t.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"}),"FolderOpen"),Rt=P(t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),Mt=P(t.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Dt=P(t.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),N="/api/folders",It=async e=>(await z.post(N,e)).data,Et=async(e,s)=>(await z.patch(`${N}/${e}`,s)).data,wt=async(e,s)=>(await z.post(`${N}/${e}/move`,s)).data,Ot=async(e,s)=>(await z.post(`${N}/${e}/copy`,s)).data,Pt=async e=>(await z.delete(`${N}/${e}`)).data,kt=async e=>(await z.post(`${N}/${e}/restore`)).data,Tt=async e=>(await z.get(`${N}/${e}`)).data,zt=async()=>(await z.get(N)).data,Nt=async()=>(await z.get(`${N}/root`)).data,Lt=async e=>(await z.get(`${N}/${e}/children`)).data,B={createFolder:It,updateFolder:Et,moveFolder:wt,copyFolder:Ot,deleteFolder:Pt,restoreFolder:kt,getFolderById:Tt,getAllFolders:zt,getRootFolders:Nt,getChildFolders:Lt},w={all:["folders"],lists:()=>[...w.all,"list"],list:e=>[...w.lists(),e],details:()=>[...w.all,"detail"],detail:e=>[...w.details(),e],roots:()=>[...w.all,"roots"],children:e=>[...w.all,"children",e]},ye=()=>pt({queryKey:w.lists(),queryFn:()=>B.getAllFolders()}),At=()=>{const e=H();return ee({mutationFn:s=>B.createFolder(s),onSuccess:()=>{e.invalidateQueries({queryKey:w.all})}})},Qt=()=>{const e=H();return ee({mutationFn:({folderId:s,request:r})=>B.updateFolder(s,r),onSuccess:s=>{e.invalidateQueries({queryKey:w.all}),e.setQueryData(w.detail(s.id),s)}})},_t=()=>{const e=H();return ee({mutationFn:({folderId:s,request:r})=>B.moveFolder(s,r),onSuccess:()=>{e.invalidateQueries({queryKey:w.all})}})},Ut=()=>{const e=H();return ee({mutationFn:({folderId:s,request:r})=>B.copyFolder(s,r),onSuccess:()=>{e.invalidateQueries({queryKey:w.all})}})},$t=()=>{const e=H();return ee({mutationFn:s=>B.deleteFolder(s),onSuccess:()=>{e.invalidateQueries({queryKey:w.all})}})},ke=({folder:e,level:s,isSelected:r,onSelect:n,onCreateFolder:i,onRenameFolder:o,onMoveFolder:a,onCopyFolder:p,onDeleteFolder:c})=>{const[h,u]=l.useState(!1),[x,d]=l.useState(null),f=e.children&&e.children.length>0,C=m=>{m.stopPropagation(),d(m.currentTarget)},R=()=>{d(null)},M=m=>{R(),m()};return t.jsxs(t.Fragment,{children:[t.jsxs(j,{sx:{display:"flex",alignItems:"center",pl:s*3,py:.5,cursor:"pointer",backgroundColor:r?"action.selected":"transparent","&:hover":{backgroundColor:"action.hover"}},onClick:()=>n(e.id),children:[t.jsx(pe,{size:"small",onClick:m=>{m.stopPropagation(),u(!h)},sx:{visibility:f?"visible":"hidden"},children:h?t.jsx(St,{fontSize:"small"}):t.jsx(yt,{fontSize:"small"})}),h?t.jsx(Ft,{fontSize:"small",sx:{mr:1,color:"primary.main"}}):t.jsx(Y,{fontSize:"small",sx:{mr:1,color:"action.active"}}),t.jsx(b,{variant:"body2",sx:{flexGrow:1},children:e.name}),t.jsx(b,{variant:"caption",color:"text.secondary",sx:{mr:1},children:e.deckCount||0}),t.jsx(pe,{size:"small",onClick:C,children:t.jsx(Mt,{fontSize:"small"})}),t.jsxs(Ke,{anchorEl:x,open:!!x,onClose:R,onClick:m=>m.stopPropagation(),children:[t.jsxs(K,{onClick:()=>M(()=>i?.(e.id)),children:[t.jsx(q,{children:t.jsx(ge,{fontSize:"small"})}),t.jsx(T,{children:"New Subfolder"})]}),t.jsxs(K,{onClick:()=>M(()=>o?.(e)),children:[t.jsx(q,{children:t.jsx(Ct,{fontSize:"small"})}),t.jsx(T,{children:"Rename"})]}),t.jsxs(K,{onClick:()=>M(()=>a?.(e)),children:[t.jsx(q,{children:t.jsx(bt,{fontSize:"small"})}),t.jsx(T,{children:"Move"})]}),t.jsxs(K,{onClick:()=>M(()=>p?.(e)),children:[t.jsx(q,{children:t.jsx(jt,{fontSize:"small"})}),t.jsx(T,{children:"Copy"})]}),t.jsxs(K,{onClick:()=>M(()=>c?.(e)),children:[t.jsx(q,{children:t.jsx(vt,{fontSize:"small",color:"error"})}),t.jsx(T,{children:"Delete"})]})]})]}),f&&t.jsx(Ye,{in:h,timeout:"auto",unmountOnExit:!0,children:e.children?.map(m=>t.jsx(ke,{folder:m,level:s+1,isSelected:m.id===e.id,onSelect:n,onCreateFolder:i,onRenameFolder:o,onMoveFolder:a,onCopyFolder:p,onDeleteFolder:c},m.id))})]})},Ht=({folders:e,isLoading:s,error:r,selectedFolderId:n,onSelectFolder:i,onCreateFolder:o,onRenameFolder:a,onMoveFolder:p,onCopyFolder:c,onDeleteFolder:h})=>{const u=l.useMemo(()=>{const x=(d=null)=>e.filter(f=>f.parentId===d).map(f=>({...f,children:x(f.id)}));return x(null)},[e]);return s?t.jsx(re,{children:t.jsx(ne,{children:t.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:t.jsx(_,{})})})}):r?t.jsx(re,{children:t.jsx(ne,{children:t.jsxs(U,{severity:"error",children:["Failed to load folders: ",r.message]})})}):t.jsx(re,{children:t.jsxs(ne,{sx:{p:0},children:[t.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:1,borderColor:"divider"},children:[t.jsx(b,{variant:"h6",children:"Folders"}),t.jsx(pe,{size:"small",color:"primary",onClick:()=>o?.(null),title:"Create Root Folder",children:t.jsx(ge,{})})]}),t.jsx(j,{sx:{maxHeight:600,overflow:"auto"},children:u.length===0?t.jsx(j,{p:3,textAlign:"center",children:t.jsx(b,{variant:"body2",color:"text.secondary",children:"No folders yet. Click + to create your first folder."})}):u.map(x=>t.jsx(ke,{folder:x,level:0,isSelected:x.id===n,onSelect:i||(()=>{}),onCreateFolder:o,onRenameFolder:a,onMoveFolder:p,onCopyFolder:c,onDeleteFolder:h},x.id))})]})})},Wt=({open:e,onClose:s,parentId:r=null,parentName:n="Root"})=>{const[i,o]=l.useState(""),[a,p]=l.useState(""),[c,h]=l.useState(""),[u,x]=l.useState(""),d=At();l.useEffect(()=>{e&&(o(""),p(""),h(""),x(""))},[e]);const f=y=>{const D=y.trim();return D.length===0?(h("Folder name is required"),!1):D.length>100?(h("Folder name must be 100 characters or less"),!1):(h(""),!0)},C=y=>y.length>500?(x("Description must be 500 characters or less"),!1):(x(""),!0),R=y=>{const D=y.target.value;o(D),f(D)},M=y=>{const D=y.target.value;p(D),C(D)},m=async y=>{y.preventDefault();const D=f(i),$=C(a);if(!(!D||!$))try{await d.mutateAsync({name:i.trim(),description:a.trim()||null,parentId:r}),O.success("Folder created successfully"),s()}catch(I){const F=I?.response?.data?.message||I?.message||"Failed to create folder";O.error(F)}},S=y=>{y.key==="Enter"&&!y.shiftKey?(y.preventDefault(),m(y)):y.key==="Escape"&&s()},g=d.isPending||i.trim().length===0||c.length>0||u.length>0;return t.jsx(J,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:t.jsxs("form",{onSubmit:m,children:[t.jsx(X,{children:"Create New Folder"}),t.jsx(Z,{children:t.jsxs(j,{sx:{pt:1},children:[t.jsx(j,{sx:{mb:2},children:t.jsxs(b,{variant:"body2",color:"text.secondary",children:["Parent Folder: ",t.jsx("strong",{children:n})]})}),t.jsx(G,{label:"Folder Name",value:i,onChange:R,onKeyDown:S,error:!!c,helperText:c||`${i.length}/100`,required:!0,fullWidth:!0,autoFocus:!0,margin:"normal",placeholder:"e.g., IELTS Preparation"}),t.jsx(G,{label:"Description (Optional)",value:a,onChange:M,onKeyDown:S,error:!!u,helperText:u||`${a.length}/500`,fullWidth:!0,multiline:!0,rows:3,margin:"normal",placeholder:"e.g., Materials for IELTS exam preparation"}),d.isError&&t.jsx(U,{severity:"error",sx:{mt:2},children:d.error?.message||"Failed to create folder"})]})}),t.jsxs(te,{children:[t.jsx(E,{onClick:s,disabled:d.isPending,children:"Cancel"}),t.jsx(E,{type:"submit",variant:"contained",disabled:g,startIcon:d.isPending&&t.jsx(_,{size:16}),children:"Create Folder"})]})]})})},Bt=({open:e,onClose:s,folder:r})=>{const[n,i]=l.useState(""),[o,a]=l.useState(""),[p,c]=l.useState(""),[h,u]=l.useState(""),x=Qt();l.useEffect(()=>{e&&r&&(i(r.name),a(r.description||""),c(""),u(""))},[e,r]);const d=g=>{const y=g.trim();return y.length===0?(c("Folder name cannot be empty"),!1):y.length>100?(c("Folder name must be 100 characters or less"),!1):(c(""),!0)},f=g=>g.length>500?(u("Description must be 500 characters or less"),!1):(u(""),!0),C=g=>{const y=g.target.value;i(y),d(y)},R=g=>{const y=g.target.value;a(y),f(y)},M=async g=>{if(g.preventDefault(),!r)return;const y=d(n),D=f(o);if(!y||!D)return;const $=n.trim()!==r.name,I=o.trim()!==(r.description||"");if(!$&&!I){O.info("No changes made"),s();return}try{await x.mutateAsync({folderId:r.id,request:{name:$?n.trim():void 0,description:I?o.trim()||null:void 0}}),O.success("Folder renamed successfully"),s()}catch(F){const L=F?.response?.data?.message||F?.message||"Failed to rename folder";O.error(L)}},m=g=>{g.key==="Enter"&&!g.shiftKey?(g.preventDefault(),M(g)):g.key==="Escape"&&s()},S=x.isPending||n.trim().length===0||p.length>0||h.length>0;return r?t.jsx(J,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:t.jsxs("form",{onSubmit:M,children:[t.jsx(X,{children:"Rename Folder"}),t.jsx(Z,{children:t.jsxs(j,{sx:{pt:1},children:[t.jsx(G,{label:"Folder Name",value:n,onChange:C,onKeyDown:m,error:!!p,helperText:p||`${n.length}/100`,required:!0,fullWidth:!0,autoFocus:!0,margin:"normal"}),t.jsx(G,{label:"Description (Optional)",value:o,onChange:R,onKeyDown:m,error:!!h,helperText:h||`${o.length}/500`,fullWidth:!0,multiline:!0,rows:3,margin:"normal"}),x.isError&&t.jsx(U,{severity:"error",sx:{mt:2},children:x.error?.message||"Failed to rename folder"})]})}),t.jsxs(te,{children:[t.jsx(E,{onClick:s,disabled:x.isPending,children:"Cancel"}),t.jsx(E,{type:"submit",variant:"contained",disabled:S,startIcon:x.isPending&&t.jsx(_,{size:16}),children:"Save Changes"})]})]})}):null},Kt=({open:e,onClose:s,folder:r})=>{const[n,i]=l.useState(null),o=_t(),{data:a=[],isLoading:p}=ye();l.useEffect(()=>{e&&i(null)},[e]);const c=l.useMemo(()=>{if(!r)return[];const d=(f,C)=>a.find(M=>M.id===f)?.path.startsWith(C)||!1;return a.filter(f=>!(f.id===r.id||d(f.id,r.path)))},[r,a]),h=(d=null,f=0)=>c.filter(C=>C.parentId===d).map(C=>t.jsxs(j,{children:[t.jsx(W,{disablePadding:!0,sx:{pl:f*3},children:t.jsxs(oe,{selected:n===C.id,onClick:()=>i(C.id),children:[t.jsx(Y,{sx:{mr:1,color:"action.active"},fontSize:"small"}),t.jsx(T,{primary:C.name})]})}),h(C.id,f+1)]},C.id)),u=async()=>{if(r){if(n===r.parentId){O.info("Folder is already in this location"),s();return}try{await o.mutateAsync({folderId:r.id,request:{targetParentFolderId:n}}),O.success("Folder moved successfully"),s()}catch(d){const f=d?.response?.data?.message||d?.message||"Failed to move folder";O.error(f)}}},x=o.isPending;return r?t.jsxs(J,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:[t.jsx(X,{children:"Move Folder"}),t.jsx(Z,{children:t.jsxs(j,{sx:{pt:1},children:[t.jsx(j,{sx:{mb:2},children:t.jsxs(b,{variant:"body2",color:"text.secondary",children:["Moving: ",t.jsx("strong",{children:r.name})]})}),t.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Select destination:"}),p?t.jsx(j,{display:"flex",justifyContent:"center",p:3,children:t.jsx(_,{})}):t.jsxs(j,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:400,overflow:"auto"},children:[t.jsxs(xe,{dense:!0,children:[t.jsx(W,{disablePadding:!0,children:t.jsxs(oe,{selected:n===null,onClick:()=>i(null),children:[t.jsx(Y,{sx:{mr:1,color:"primary.main"},fontSize:"small"}),t.jsx(T,{primary:"Root"})]})}),h()]}),c.length===0&&t.jsx(j,{p:2,textAlign:"center",children:t.jsx(b,{variant:"body2",color:"text.secondary",children:"No available destinations"})})]}),n!==void 0&&t.jsx(j,{sx:{mt:2,p:1.5,bgcolor:"action.hover",borderRadius:1},children:t.jsxs(b,{variant:"body2",children:["New location:"," ",t.jsxs("strong",{children:[n===null?"Root":c.find(d=>d.id===n)?.name," > ",r.name]})]})}),o.isError&&t.jsx(U,{severity:"error",sx:{mt:2},children:o.error?.message||"Failed to move folder"})]})}),t.jsxs(te,{children:[t.jsx(E,{onClick:s,disabled:o.isPending,children:"Cancel"}),t.jsx(E,{variant:"contained",onClick:u,disabled:x,startIcon:o.isPending&&t.jsx(_,{size:16}),children:"Move Here"})]})]}):null},qt=({open:e,onClose:s,folder:r})=>{const[n,i]=l.useState(""),[o,a]=l.useState(null),[p,c]=l.useState(""),h=Ut(),{data:u=[],isLoading:x}=ye();l.useEffect(()=>{e&&r&&(i(`${r.name} (copy)`),a(null),c(""))},[e,r]);const d=m=>{const S=m.trim();return S.length===0?(c("Folder name is required"),!1):S.length>100?(c("Folder name must be 100 characters or less"),!1):(c(""),!0)},f=m=>{const S=m.target.value;i(S),d(S)},C=(m=null,S=0)=>u.filter(g=>g.parentId===m).map(g=>t.jsxs(j,{children:[t.jsx(W,{disablePadding:!0,sx:{pl:S*3},children:t.jsxs(oe,{selected:o===g.id,onClick:()=>a(g.id),children:[t.jsx(Y,{sx:{mr:1,color:"action.active"},fontSize:"small"}),t.jsx(T,{primary:g.name})]})}),C(g.id,S+1)]},g.id)),R=async()=>{if(r&&d(n))try{await h.mutateAsync({folderId:r.id,request:{destinationFolderId:o,newName:n.trim()}}),O.success("Folder copied successfully"),s()}catch(m){const S=m?.response?.data?.message||m?.message||"Failed to copy folder";O.error(S)}},M=h.isPending||n.trim().length===0||p.length>0;return r?t.jsxs(J,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:[t.jsx(X,{children:"Copy Folder"}),t.jsx(Z,{children:t.jsxs(j,{sx:{pt:1},children:[t.jsx(j,{sx:{mb:2},children:t.jsxs(b,{variant:"body2",color:"text.secondary",children:["Source: ",t.jsx("strong",{children:r.name})]})}),t.jsx(G,{label:"New name",value:n,onChange:f,error:!!p,helperText:p||`${n.length}/100`,required:!0,fullWidth:!0,margin:"normal"}),t.jsx(b,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Destination:"}),x?t.jsx(j,{display:"flex",justifyContent:"center",p:3,children:t.jsx(_,{})}):t.jsx(j,{sx:{border:1,borderColor:"divider",borderRadius:1,maxHeight:300,overflow:"auto"},children:t.jsxs(xe,{dense:!0,children:[t.jsx(W,{disablePadding:!0,children:t.jsxs(oe,{selected:o===null,onClick:()=>a(null),children:[t.jsx(Y,{sx:{mr:1,color:"primary.main"},fontSize:"small"}),t.jsx(T,{primary:"Root"})]})}),C()]})}),t.jsx(U,{severity:"info",icon:t.jsx(Rt,{}),sx:{mt:2},children:"This will copy the folder and all its contents (subfolders and decks)."}),h.isError&&t.jsx(U,{severity:"error",sx:{mt:2},children:h.error?.message||"Failed to copy folder"})]})}),t.jsxs(te,{children:[t.jsx(E,{onClick:s,disabled:h.isPending,children:"Cancel"}),t.jsx(E,{variant:"contained",onClick:R,disabled:M,startIcon:h.isPending&&t.jsx(_,{size:16}),children:"Copy Here"})]})]}):null},Vt=({open:e,onClose:s,folder:r})=>{const n=$t(),i=async()=>{if(r)try{const p=await n.mutateAsync(r.id);O.success(`Folder deleted successfully. ${p.deletedFolders} folders and ${p.deletedDecks} decks removed.`),s()}catch(p){const c=p?.response?.data?.message||p?.message||"Failed to delete folder";O.error(c)}};if(!r)return null;const o=r.children?.length||0,a=r.deckCount||0;return t.jsxs(J,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:[t.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Dt,{color:"warning"}),"Delete Folder?"]}),t.jsx(Z,{children:t.jsxs(j,{sx:{pt:1},children:[t.jsx(b,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to delete:"}),t.jsxs(j,{sx:{p:2,my:2,bgcolor:"error.lighter",borderRadius:1,border:1,borderColor:"error.light"},children:[t.jsx(b,{variant:"h6",color:"error.main",children:r.name}),r.description&&t.jsx(b,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:r.description})]}),(o>0||a>0)&&t.jsxs(j,{sx:{mb:2},children:[t.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"This folder contains:"}),t.jsxs(xe,{dense:!0,disablePadding:!0,children:[o>0&&t.jsx(W,{disablePadding:!0,children:t.jsx(T,{primary:`• ${o} subfolder${o>1?"s":""}`})}),a>0&&t.jsx(W,{disablePadding:!0,children:t.jsx(T,{primary:`• ${a} deck${a>1?"s":""}`})})]})]}),t.jsx(U,{severity:"info",sx:{mt:2},children:"You can restore this folder within 30 days from the Trash."}),n.isError&&t.jsx(U,{severity:"error",sx:{mt:2},children:n.error?.message||"Failed to delete folder"})]})}),t.jsxs(te,{children:[t.jsx(E,{onClick:s,disabled:n.isPending,children:"Cancel"}),t.jsx(E,{variant:"contained",color:"error",onClick:i,disabled:n.isPending,startIcon:n.isPending&&t.jsx(_,{size:16}),children:"Delete"})]})]})},os=()=>{const[e,s]=l.useState(null),[r,n]=l.useState(!1),[i,o]=l.useState(null),[a,p]=l.useState("Root"),[c,h]=l.useState(!1),[u,x]=l.useState(null),[d,f]=l.useState(!1),[C,R]=l.useState(null),[M,m]=l.useState(!1),[S,g]=l.useState(null),[y,D]=l.useState(!1),[$,I]=l.useState(null),{data:F=[],isLoading:L,error:A}=ye(),Q=v=>{const ce=v?F.find(Te=>Te.id===v):null;o(v||null),p(ce?.name||"Root"),n(!0)},je=v=>{x(v),h(!0)},ve=v=>{R(v),f(!0)},be=v=>{g(v),m(!0)},Ce=v=>{I(v),D(!0)};return t.jsxs(t.Fragment,{children:[t.jsx(qe,{children:t.jsx("title",{children:"Folder Management - RepeatWise"})}),t.jsx(Ge,{children:t.jsx(Ve,{heading:"Folder Management",subHeading:"Organize your decks with folders. Create, rename, move, copy, and delete folders.",docs:"https://docs.repeatwise.com/folder-management"})}),t.jsx(Je,{maxWidth:"lg",children:t.jsxs(de,{container:!0,spacing:3,children:[t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(Ht,{folders:F,isLoading:L,error:A,selectedFolderId:e,onSelectFolder:s,onCreateFolder:Q,onRenameFolder:je,onMoveFolder:ve,onCopyFolder:be,onDeleteFolder:Ce})}),t.jsx(de,{item:!0,xs:12,md:6,children:t.jsx(re,{children:t.jsx(ne,{children:e?(()=>{const v=F.find(ce=>ce.id===e);return v?t.jsxs(j,{children:[t.jsx(b,{variant:"h5",gutterBottom:!0,children:v.name}),v.description&&t.jsx(b,{variant:"body2",color:"text.secondary",paragraph:!0,children:v.description}),t.jsxs(j,{sx:{mt:3},children:[t.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Information"}),t.jsxs(b,{variant:"body2",color:"text.secondary",children:["• Depth: Level ",v.depth]}),t.jsxs(b,{variant:"body2",color:"text.secondary",children:["• Decks: ",v.deckCount||0]}),t.jsxs(b,{variant:"body2",color:"text.secondary",children:["• Created: ",new Date(v.createdAt).toLocaleDateString()]}),t.jsxs(b,{variant:"body2",color:"text.secondary",children:["• Updated: ",new Date(v.updatedAt).toLocaleDateString()]})]}),t.jsxs(j,{sx:{mt:3,display:"flex",gap:1,flexWrap:"wrap"},children:[t.jsx(E,{variant:"outlined",size:"small",onClick:()=>Q(v.id),children:"New Subfolder"}),t.jsx(E,{variant:"outlined",size:"small",onClick:()=>je(v),children:"Rename"}),t.jsx(E,{variant:"outlined",size:"small",onClick:()=>ve(v),children:"Move"}),t.jsx(E,{variant:"outlined",size:"small",onClick:()=>be(v),children:"Copy"}),t.jsx(E,{variant:"outlined",size:"small",color:"error",onClick:()=>Ce(v),children:"Delete"})]})]}):t.jsx(b,{variant:"body2",color:"text.secondary",children:"Folder not found"})})():t.jsxs(j,{textAlign:"center",py:4,children:[t.jsx(b,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No folder selected"}),t.jsx(b,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Select a folder from the tree to view details and perform actions."}),t.jsx(E,{variant:"contained",startIcon:t.jsx(ge,{}),onClick:()=>Q(null),children:"Create Root Folder"})]})})})})]})}),t.jsx(Wt,{open:r,onClose:()=>n(!1),parentId:i,parentName:a}),t.jsx(Bt,{open:c,onClose:()=>h(!1),folder:u}),t.jsx(Kt,{open:d,onClose:()=>f(!1),folder:C}),t.jsx(qt,{open:M,onClose:()=>m(!1),folder:S}),t.jsx(Vt,{open:y,onClose:()=>D(!1),folder:$})]})};export{os as default};
